{% extends 'base.html' %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'main/css/style.css' %}">
<link rel="stylesheet" href="{% static 'teacherProfile/css/profile.css' %}">
{% endblock %}

{% block content %}
<section class="profile">
    <div class="container">
        <div class="profile-info">
            <div class="container-profile">
                <h1 class="profile-title">Информация о Вас</h1>
                <img src="{% static 'teacherProfile/media/kazakov.svg' %}" alt="Фото профиля" class="profile-img">
                <p class="profile-name">ФИО: {{ user.get_full_name }}</p>
                <p class="profile-job">Должность: {{ user.position }}</p>
                <p class="profile-groups">Курируемые группы: 
                    {% for group in curated_groups %}
                        {{ group.name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                </p>
            </div>
            
            <div class="container-group">
                <div class="group-manager">
                    <h3>Управление группами:</h3>
                    <div class="group-filters">
                        <select id="facultySelect" onchange="updateGroups()">
                            <option value="">Все факультеты</option>
                            <option value="EiEB" {% if selected_faculty == 'EiEB' %}selected{% endif %}>
                                Экономика и экономическая безопасность
                            </option>
                            <option value="IT" {% if selected_faculty == 'IT' %}selected{% endif %}>
                                Информационные технологии
                            </option>
                        </select>

                        <select id="courseSelect" onchange="updateGroups()">
                            <option value="">Все курсы</option>
                            {% for i in "1234" %}
                            <option value="{{ i }}" {% if selected_course == i %}selected{% endif %}>
                                {{ i }} курс
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="current-groups" onchange="updateGroups()">
                        <h4>Ваши группы:</h4>
                        <div class="group-list">
                            {% for group in curated_groups %}
                            <div class="group-tab {% if group.id == selected_group.id %}active{% endif %}">
                                {{ group.name }}
                                <button class="remove-group" 
                                        onclick="removeGroup(event, {{ group.id }})">×</button>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="add-group-section">
                        <select id="availableGroups">
                            <option value="">Выберите группу для добавления</option>
                            {% for group in available_groups %}
                            <option value="{{ group.id }}">
                                {{ group.name }} ({{ group.get_faculty_display }} {{ group.course }} курс)
                            </option>
                            {% endfor %}
                        </select>
                        <button class="add-group-btn" onclick="addGroup()">+ Добавить группу</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="students-section">
            <h2>Студенты группы: {{ selected_group.name|default:"Группа не выбрана!" }}</h2>
            <div class="students-list" id="students-list">
                {% for student in students %}
                <div class="student-item" data-id="{{ student.id }}">
                    <span>{{ forloop.counter }}. {{ student.full_name }}</span>
                    <button class="delete-btn" onclick="deleteStudent({{ student.id }})">×</button>
                </div>
                {% endfor %}
                {% if form.image.errors %}
                <div class="alert alert-danger alert-dismissible fade show">{{form.image.errors}}</div>
                {% endif %}
            </div>
            <button class="add-student-btn" onclick="showAddForm()">+ Добавить студента</button>
        </div>
    </div>
</section>

<div id="addModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Добавить студента</h3>
            <span class="close" onclick="closeModal()">&times;</span>
        </div>
        <div id="error-message" class="error-message"></div>
        <form id="studentForm">
            {% csrf_token %}
            <input type="hidden" name="group_id" value="{{ selected_group.id }}">
            <div class="form-group">
                <label>Номер зачетной книги:</label>
                <input type="text" name="record_book" required 
                       class="modern-input"
                       placeholder="Введите номер зачётки">
            </div>
            <div class="form-group">
                <label>ФИО:</label>
                <input type="text" name="full_name" required
                       class="modern-input"
                       placeholder="Иванов Иван Иванович">
            </div>
            <div class="form-actions">
                <button type="submit" class="modern-btn">Сохранить</button>
                <button type="button" class="modern-btn cancel" 
                        onclick="closeModal()">Отмена</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}